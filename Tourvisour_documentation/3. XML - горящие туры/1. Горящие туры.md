# XML шлюз TOURVISOR

## ГОРЯЩИЕ ТУРЫ

Сервис получения информации по горящим турам. Позволяет получать информацию в формате XML либо JSON, тем самым возможно реализовать полностью индивидуальный внешний вид и компоновку горящих туров.

Получение информации по горящим турам осуществляется путем GET-запроса на адрес:

```
http://tourvisor.ru/xml/hottours.php
```

Результаты выдаются в кодировке **UTF-8 (Unicode)**.

---

## 1. Авторизация

При работе со шлюзом требуется авторизация. Для этого используется логин и пароль от личного кабинета TourVisor.ru.

**Параметры авторизации:**

| Параметр | Описание |
|----------|----------|
| `authlogin` | логин в системе TourVisor |
| `authpass` | пароль в системе TourVisor |

**Пример:**

```
http://tourvisor.ru/xml/hottours.php?city=1&items=10&authlogin=testsite&authpass=123123
```

---

## 2. Основные параметры

| Параметр | Описание |
|----------|----------|
| `format` | формат выдачи xml или json (по умолчанию json) |
| `items` | количество горящих туров, которые необходимо получить (цифра от 1 до 100). **Указывается обязательно!** |
| `city` | код города вылета для выдачи горящих туров (например, 1 = Москва). **Указывается обязательно!** |

---

## 3. Дополнительные параметры (необязательные)

| Параметр | Описание |
|----------|----------|
| `city2` | код второго (дополнительного) города вылета. Туры в этот город выдаются с меньшим приоритетом. См.ниже «Сочетания городов вылета» для примеров использования. |
| `city3` | код третьего (дополнительного) города вылета. Туры в этот город выдаются с меньшим приоритетом. |
| `uniq2` | только уникальные направления для города вылета 2 (city2). 1 или 0. |
| `uniq3` | только уникальные направления для города вылета 3 (city3). 1 или 0. |
| `maxdays` | максимальное количество дней от сегодняшнего числа, на которые выдаются горящие туры. Например, если передать 7, то будут туры только на ближайшую неделю. Если 0 или не указано – период не ограничен. Удобно, чтобы ограничить туры, например, на ближайший месяц. |
| `countries` | список кодов стран через запятую. Если требуется ограничить горящие туры только одной страной (или несколькими странами), то в данном параметре передается код страны (или несколько через запятую). **Важно** - горящие туры могут быть не по всем странам! |
| `regions` | список кодов курортов через запятую. Если требуется ограничить горящие туры только определенным курортом (или несколькими курортами), то в данном параметре передается код курорта (или несколько через запятую). Будьте внимательны – коды курортов должны соответствовать странам, которые Вы передаете в параметре countries. **Важно** - горящие туры могут быть не по всем курортам! |
| `operators` | список кодов туроператоров через запятую. Если требуется ограничить горящие туры только по определенным туроператорам. **Важно** - горящие туры могут быть не по всем туроператорам! |
| `datefrom` | эти параметры (datefrom и dateto) ограничивают диапазон дат, на которые выдаются горящие туры (т.е. можно получить горящие туры на произвольный период – например, на Новогодние праздники или, например, с 1 мая по 9 мая). Формат даты – 01.01.2015. **Важно** - горящие туры могут быть не на все даты! |
| `dateto` | конец диапазона дат (формат 01.01.2015). См. описание datefrom. |
| `stars` | ограничить минимальную звездность отелей в горящих турах. Например, если задать stars=4, то система выдаст только отели 4* и 5*. |
| `rating` | ограничить минимальный рейтинг отелей в горящих турах. Рейтинг соответствует рейтингу в поисковой системе, от 1 до 5. Задается либо целым числом (например rating=4 – рейтинг отеля не меньше 4), либо дробным через точку (например, rating=3.5 – отели с рейтингом не менее 3.5). |
| `meal` | ограничить минимальное питание в горящих турах. Передается код типа питания (можно взять из справочников). Например, если задать meal=7, то система выдаст только горящие туры с питанием «All Inclusive» и лучше. |
| `picturetype` | тип картинки (фотографии) отеля = 0 или 1. По-умолчанию (0) – картинка стандартного размера (ширина 130 пикселей). 1 = большие картинки (ширина 250 пикселей). |
| `tourtype` | тип тура (цифра от 0 до 3). По-умолчанию (0) = любые туры, 1 = пляжные туры, 2 = горнолыжные, 3 = экскурсионные. |
| `visa` | фильтр по визовым направлениям. 0 (по-умолчанию) = любые страны, 1 = только безвизовые. |
| `sort` | сортировка горящих туров. 0 (по-умолчанию) = по рейтингу "полезности", 1 = по цене. |
| `currency` | валюта, в которой производить выдачу результатов поиска. 0 = рубли (по-умолчанию), 1 – у.е. (USD или EUR, зависит от страны) |

---

## 4. Сочетания городов вылета

Всегда должен быть задан хотя бы основной город вылета (параметр `city`). Если задан только он, то выдаются горящие туры с вылетом из этого города.

Если Вы хотите, чтобы в одном запросе передавались также туры из альтернативных городов, то можно указать 1 или 2 дополнительных города вылета.

**Пример:** основной город – Пермь (`city=2`), дополнительные города – Екатеринбург (`city2=3`) и Москва (`city3=1`). В этом случае в наборе горящих туров приоритет будет отдаваться турам из Перми, однако, если есть очень интересные предложения из Екатеринбурга и Москвы, то они будут тоже включены в набор.

### Уникальные направления

Также есть возможность для дополнительных городов выдавать только уникальные направления (те страны, туров в которые нет из основного города).

Для этого служат параметры `uniq2` и `uniq3`. Т.е. если к предыдущему примеру добавить параметры `uniq2=1` и `uniq3=1`, то будут выданы горящие туры из Перми, а также туры из Екатеринбурга и Москвы, но только по тем странам, куда нет вылетов из Перми.

---

## 5. Результаты – набор горящих туров

В ответе на запрос передается набор горящих туров, которые соответствуют заданным параметрам.

> Возможны ситуации, когда параметры слишком строгие и горящих туров не найдено – в этом случае результат не будет выдан.

В параметре `hotcount` содержится количество найденных горящих туров.

### Блок hottours

Блок результатов содержит массив элементов `tour`:

| Поле | Описание |
|------|----------|
| `countrycode` | код страны |
| `countryname` | название страны (на русском) |
| `departurecode` | код города вылета |
| `departurename` | название города вылета (на русском) |
| `departurenamefrom` | название города вылета в родительном падеже (удобно, чтобы указывать откуда вылет – например, из Перми, из Москвы, из Екатеринбурга). |
| `operatorcode` | код туроператора |
| `operatorname` | название туроператора |
| `hotelcode` | код отеля |
| `hotelname` | название отеля |
| `hotelstars` | категория отеля (2,3,4 или 5) |
| `hotelregioncode` | код курорта для данного отеля |
| `hotelregionname` | название курорта для данного отеля (на русском) |
| `hotelpicture` | ссылка на фотографию отеля |
| `fulldesclink` | ссылка на полное описание отеля (в модуль описаний), если есть |
| `flydate` | дата вылета по туру (в формате 01.01.2015) |
| `nights` | длительность тура (количество ночей) |
| `meal` | тип питания (текстовый) |
| `price` | цена в рублях (текущая) – указана **цена за человека (1/2 DBL)** |
| `priceold` | старая цена в рублях (предыдущая цена, до снижения). Вы также можете рассчитать процент снижения цены = 100 * ( priceold – price) / priceold |
| `currency` | код (название) валюты, в которой представлена цена. Один из: RUB, EUR, USD |

---

## 6. Получение информации JSONP

Возможно получение горящих туров прямо из Javascript.

В этом случае авторизация не требуется (т.к. иначе пришлось бы размещать пароль в открытом доступе), но запросы обязательно должны производиться с домена, который привязан к активной учетной записи в системе TourVisor.

**Пример готового простого скрипта для вывода горящих туров с использованием библиотеки jQuery:**

```
http://tourvisor.ru/xml/demo/demohot.html
```

В этом примере происходит запрос горящих туров и затем выдача их в стандартном дизайне модуля «Горящие туры». Вы можете взять этот образец скрипта и модифицировать его под свои нужды.

---

## 7. Примеры

> Для тестирования замените в примерах логин и пароль на Ваши!

**10 горящих туров из Москвы:**

```
http://tourvisor.ru/xml/hottours.php?city=1&items=10&authlogin=test&authpass=123
```

**Горящие туры из Москвы на ближайшие 14 дней, отели 4* и 5* с рейтингом от 3.5:**

```
http://tourvisor.ru/xml/hottours.php?city=1&items=10&maxdays=14&stars=4&rating=3.5&authlogin=test&authpass=123
```

**Горящие туры в Египет и Турцию на ближайшие 10 дней, питание AI и лучше:**

```
http://tourvisor.ru/xml/hottours.php?city=1&items=10&countries=1,4&meal=7&authlogin=test&authpass=123
```

**Горящие туры из Перми по всем доступным странам, а также из Екатеринбурга по странам, которых нет из Перми:**

```
http://tourvisor.ru/xml/hottours.php?city=2&city2=3&uniq2=1&items=10&authlogin=test&authpass=123
```
