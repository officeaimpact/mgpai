# XML шлюз TOURVISOR

## АКТУАЛИЗАЦИЯ

Сервис актуализации позволяет для конкретного тура по его идентификатору (поле `tourid` в результатах поиска и горящих турах):

- получить детальную информацию
- проверить цену тура в системе туроператора (см. параметр `request`)
- получить список авиарейсов по туру можно при помощи нового метода - "Детальная актуализация"

Результаты выдаются в кодировке **UTF-8 (Unicode)**.

> **Важная информация!**
> При осуществлении актуализации тура могут производиться запросы в систему туроператора, такие запросы считаются как обычные поисковые запросы и учитываются в Вашей статистике, что может приводить к превышению бесплатного лимита запросов. Подробнее см. параметр `request` (ниже).

---

## 1. Авторизация

При работе со шлюзом требуется авторизация. Для этого используется логин и пароль от личного кабинета TourVisor.ru.

**Параметры авторизации:**

| Параметр | Описание |
|----------|----------|
| `authlogin` | логин в системе TourVisor |
| `authpass` | пароль в системе TourVisor |

Либо возможна актуализация по ключу (в этом случае логин/пароль не нужны):

| Параметр | Описание |
|----------|----------|
| `authkey` | API-ключ Вашего аккаунта в системе TourVisor |

---

## 2. Осуществление запроса

Для того, чтобы осуществить актуализацию тура, необходимо передать параметры актуализации GET запросом на адрес:

```
http://tourvisor.ru/xml/actualize.php
```

### Параметры запроса

| Параметр | Описание |
|----------|----------|
| `format` | формат выдачи xml или json (по умолчанию xml) |
| `tourid` | цифровой идентификатор тура из соответствующего поля поискового шлюза. **Указывается обязательно!** |
| `request` | производить ли фактический запрос в систему туроператора (проверку цены в системе туроператора). **0** = определять автоматически (наша система делает запрос только в случае необходимости). **1** = всегда делать запрос (принудительно). **2** = никогда не делать запроса (информация берется из базы данных). По-умолчанию = 0. |
| `currency` | валюта, в которой выдавать цену. 0 = рубли (по-умолчанию), 1 – у.е. (USD или EUR, зависит от страны), 2 – бел.рубли, 3 – тенге |

> **Обратите внимание, что** если производится фактический запрос в систему туроператора, то он учитывается как отдельный поисковый запрос в нашей системе (в случае большого количества таких запросов, Вы можете превысить лимит на количество запросов в сутки, превышение придется оплачивать дополнительно). Поэтому мы не рекомендуем делать массовые запросы актуализации туров. Если Вы хотите, чтобы запросы на актуализацию гарантированно не попадали в суточный лимит запросов, то устанавливайте параметр `request=2`.

---

## 3. Результаты – данные тура

В ответе на запрос передается набор данных по туру (внутри тега `tour`):

| Поле | Описание |
|------|----------|
| `hotelcode` | код отеля |
| `hotelname` | название отеля |
| `hotelstars` | категория отеля (2,3,4 или 5) |
| `hotelregioncode` | код курорта для данного отеля |
| `hotelregionname` | название курорта для данного отеля (на русском) |
| `countrycode` | код страны |
| `countryname` | название страны (на русском) |
| `departurecode` | код города вылета |
| `departurename` | название города вылета (на русском) |
| `operatorcode` | код туроператора |
| `operatorname` | название туроператора |
| `flydate` | дата вылета по туру (в формате 01.01.2015) |
| `nights` | длительность тура (количество ночей) |
| `meal` | тип питания |
| `room` | тип комнаты |
| `placement` | название типа размещения (например «2 взрослых») |
| `adults` | кол-во взрослых |
| `child` | кол-во детей |
| `childage1` | возраст первого ребенка (передается только если есть дети) |
| `childage2` | возраст 2 ребенка (передается только если есть дети) |
| `childage3` | возраст 3 ребенка (передается только если есть дети) |
| `price` | полная цена тура в рублях. Цена уже содержит топливный сбор и уже учитывает скидку, которая настроена в личном кабинете (т.е. алгоритм расчета совпадает с алгоритмом расчета для обычного поискового модуля, установленного на сайте). |
| `fuelcharge` | топливный сбор в рублях (на весь тур) |
| `visacharge` | стоимость оформления визы в рублях (на человека! Если Вы хотите получить стоимость визы на всех туристов – умножьте стоимость визы на количество туристов (adults+child)) |
| `currency` | код (название) валюты, в которой представлена цена. Один из: RUB, EUR, USD, BYR, KZT |
| `operatorprice` | оригинальная цена у оператора в валюте оператора (USD / EUR) |
| `operatorcurrency` | валюта оператора для оригинальной цены (USD / EUR) |
| `tourname` | название тура (как правило, совпадает с названием тура в системе оператора) |
| `hotelpicturesmall` | ссылка на фотографию отеля (фото шириной 130 пикс) |
| `hotelpicturemedium` | ссылка на фотографию отеля (фото шириной 250 пикс) |
| `hotelpicturebig` | ссылка на фотографию отеля (фото шириной 400 пикс) |
| `hoteldescription` | краткое описание отеля (если его нет, то пусто) |
| `fulldesclink` | ссылка на полное описание отеля (если на Вашем сайте установлен модуль «Описания стран, курортов, отелей», то ссылка будет вести на Ваш сайт, иначе ссылка будет вести на наш нейтральный домен) |
| `operatorlink` | ссылка на данный тур в системе бронирования туроператора (доступно не по всем туроператорам) |
| `regular` | если = 1, то данный тур выполняется на регулярных рейсах (возможны доплаты к туру) |
| `promo` | если = 1, то данный тур - со сниженной комиссией (промо) |
| `onrequest` | метка, если она = 1, то места на авиарейсах (именно на рейсах, а не в отеле) по данному туру “под запрос”. |
| `flightstatus` | места на рейсах: 1 = “под запрос”, 2 = "мало" |
| `hotelstatus` | места в отеле: 1 = “под запрос”, 2 = "мгновенное подтверждение" |
| `nightflight` | если есть ночной перелет, указывается количество ночей в дороге |

---

## 4. Результаты – данные авиарейсов

> **Внимание!** Данный раздел (параметр `flights=1`) более не актуален!
>
> Для получения списка авиарейсов, а также детальной информации о туре используйте новый сервис - **"Детальная актуализация"**.
