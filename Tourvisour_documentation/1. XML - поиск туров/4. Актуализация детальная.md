# XML шлюз TourVisor

## ДЕТАЛЬНАЯ АКТУАЛИЗАЦИЯ

Сервис детальной актуализации позволяет для конкретного тура по его идентификатору (поле `tourid` в результатах поиска и горящих турах) получить информацию по авиарейсам а также некоторую дополнительную информацию по туру (доплаты, состав тура и т.п.).

Результаты выдаются в кодировке **UTF-8 (Unicode)**.

> **Внимание!** Получение данных производится непосредственно из системы бронирования туроператора, поэтому запросы на детальную актуализацию считаются как обычные поисковые запросы и учитываются в Вашей статистике, что может приводить к превышению бесплатного лимита запросов.

---

## 1. Авторизация

При работе со шлюзом требуется авторизация. Для этого используется логин и пароль от личного кабинета TourVisor.ru.

**Параметры авторизации:**

| Параметр | Описание |
|----------|----------|
| `authlogin` | логин в системе TourVisor |
| `authpass` | пароль в системе TourVisor |

Возможна авторизация при помощи ключа, без указания логина/пароля:

| Параметр | Описание |
|----------|----------|
| `authkey` | ключ доступа к шлюзу (для получения обратитесь в техподдержку) |

---

## 2. Осуществление запроса

Для того, чтобы осуществить актуализацию тура, необходимо передать параметры актуализации GET запросом на адрес:

```
http://tourvisor.ru/xml/actdetail.php
```

### Параметры запроса

| Параметр | Описание |
|----------|----------|
| `format` | формат выдачи xml или json (по умолчанию xml) |
| `tourid` | цифровой идентификатор тура из соответствующего поля поискового шлюза. **Указывается обязательно!** |
| `currency` | валюта, в которой производить выдачу результатов. 0 = рубли (по умолчанию), 1 – у.е. (USD или EUR, зависит от страны), 2 – бел.рубли, 3 – тенге |

---

## 3. Результаты – данные авиарейсов (блок flights)

В теге `flights` передаются данные по авиарейсам для указанного тура. В теге содержится массив наборов авиарейсов.

- В первом элементе (с ключом 0) передается набор авиарейсов **по умолчанию** (тот, который у оператора изначально указан при бронировании тура)
- В большинстве случаев этот элемент будет единственным
- Если же у оператора есть дополнительные варианты перелетов (например, другой авиакомпанией), то они будут переданы в следующих элементах массива

### Структура каждого элемента массива

Каждый элемент массива содержит в себе следующие данные (некоторые поля могут быть пустыми, если они не представлены в системе туроператора):

#### forward – массив авиаперелетов «туда»

Массив авиаперелетов «туда» (из города вылета в страну назначения). В случае, перелет единственный (например, Москва – Варна), то в массиве будет только один элемент (с ключом 0). Если же перелет составной (например, Москва – Дубай + Дубай – Мале), то каждое плечо перелета будет содержаться в отдельном элементе. Каждый элемент массива содержит в себе следующую информацию:

| Поле | Описание |
|------|----------|
| `company` | данные авиакомпании |
| `company.id` | двухбуквенный код авиакомпании |
| `company.name` | название авиакомпании |
| `company.thumb` | ссылка на логотип |
| `number` | номер авиарейса |
| `plane` | название самолета |
| `departure` | данные по вылету |
| `departure.time` | время вылета |
| `departure.port` | код и название аэропорта вылета |
| `arrival` | данные по прилету |
| `arrival.time` | время прилета |
| `arrival.port` | код и название аэропорта прилета |

#### backward – массив авиаперелетов «обратно»

Данные аналогичны массиву `forward`.

#### Дополнительные поля

| Поле | Описание |
|------|----------|
| `dateforward` | дата вылета «туда» |
| `datebackward` | дата вылета «обратно» |
| `price` | стоимость тура для данного набора авиарейсов (поле value – содержит цену за весь тур (за номер), поле currency – обозначение валюты). |
| `fuelcharge` | топливный сбор для данного набора авиарейсов (поле value – содержит топливный сбор за весь тур (за номер), поле currency – обозначение валюты). |
| `isdefault` | если true, то это набор авиарейсов по умолчанию (должен всегда совпадать с нулевым элементом массива). |

---

## 4. Результаты – дополнительная информация по туру (блок tourinfo)

В данном теге содержится несколько разделов с расширенной информацией по туру. Каждый из разделов появляется только в том случае, если соответствующая информация доступна.

### Раздел addpayments

Содержит массив с дополнительными обязательными доплатами к туру (помимо топливного сбора) – это могут быть страховка от невыезда, новогодний ужин, обязательные экскурсии и т.п.:

| Поле | Описание |
|------|----------|
| `name` | наименование доплаты |
| `amount` | сумма доплаты в выбранной валюте, **указывается на человека** |

### Раздел contents

Содержит массив с текстовым описанием состава тура.

Данная информация передается только в том случае, если четкое описание состава тура удалось получить из системы туроператора. В случае, если такая информация недоступна, в системе TourVisor используется стандартный набор для состава тура: **«Авиаперелет, Проживание в отеле, Питание, Медицинская страховка, Трансфер»**.

Для определения того, какие услуги фактически не включены в состав тура можно использовать следующий раздел (`flags`).

> К сожалению, не во всех случаях удается достоверно определить, к примеру, отсутствие трансфера в составе тура. Поэтому Вы сами можете решить стоит ли отображать стандартный набор услуг в случае, если массив `contents` пустой.

### Раздел flags

Содержит набор меток об отсутствии той или иной услуги в составе тура. Соответствующая метка ставится только в том случае, если услуга **не включена** в состав тура.

По этим меткам Вы сможете определить какие услуги не входят в тур и соответствующим образом сформировать стандартный набор состава тура, либо, к примеру, отобразить соответствующее предупреждение для туриста:

| Метка | Описание |
|-------|----------|
| `notransfer` | трансфер не входит в состав тура |
| `nomedinsurance` | медицинская страховка не входит в состав тура |
| `noflight` | перелет не входит в состав тура (только проживание в отеле) |
| `nomeal` | питание не входит в состав тура (как правило, указывается для типа питания «Без питания») |
