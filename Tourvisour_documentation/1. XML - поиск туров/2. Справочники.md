# XML шлюз TOURVISOR

## Выгрузка справочников

Возможно выгрузить справочники (списки городов вылета, стран, курортов, отелей и т.д.) в формате XML либо JSON. Также возможно получать информацию напрямую из Javascript через JSONP запрос (например, для создания и загрузки информации в нестандартные формы).

Получение справочников осуществляется путем GET-запроса на адрес:

```
http://tourvisor.ru/xml/list.php
```

Результаты выдаются в кодировке **UTF-8 (Unicode)**.

---

## 1. Авторизация

При работе со справочниками требуется авторизация. Для этого используется логин и пароль от личного кабинета TourVisor.ru (возможна работа без авторизации для JSONP запросов, но при этом запросы обязательно должны осуществляться с домена, «привязанного» к Вашей учетной записи – подробнее см.ниже).

**Параметры авторизации:**

| Параметр | Описание |
|----------|----------|
| `authlogin` | логин в системе TourVisor |
| `authpass` | пароль в системе TourVisor |

**Пример:**

```
http://tourvisor.ru/xml/list.php?format=xml&type=departure&authlogin=testsite&authpass=123123
```

---

## 2. Основные параметры

| Параметр | Описание |
|----------|----------|
| `format` | формат выдачи xml или json (по умолчанию json) |
| `type` | список типов информации, которую нужно получить через запятую. Например: departure,country,hotels. Можно указать один тип. Список типов приведен ниже. |

---

## 3. departure - список городов вылета

**Тип информации:** `departure`

Выдает полный список городов вылета, дополнительных параметров нет.

**Пример:**

```
http://tourvisor.ru/xml/list.php?format=xml&type=departure&authlogin=testsite&authpass=123123
```

---

## 4. country - список стран

**Тип информации:** `country`

Без параметров выдается полный список стран (все страны, которые есть в системе).

**Параметры:**

| Параметр | Описание |
|----------|----------|
| `cndep` | город вылета. Выдается список стран, куда есть вылеты из указанного города. |

**Примеры:**

```
http://tourvisor.ru/xml/list.php?type=country&authlogin=testsite&authpass=123123
```
(выдает полный список стран)

```
http://tourvisor.ru/xml/list.php?type=country&cndep=3&authlogin=testsite&authpass=123123
```
(выдает список стран, в которые есть вылет из города Екатеринбург (код 3))

---

## 5. region – список курортов

**Тип информации:** `region`

Без параметров выдается полный список курортов (с кодами стран).

**Параметры:**

| Параметр | Описание |
|----------|----------|
| `regcountry` | страна, по которой нужно получить список курортов |

**Примеры:**

```
http://tourvisor.ru/xml/list.php?type=region&authlogin=testsite&authpass=123123
```
(выдает полный список курортов)

```
http://tourvisor.ru/xml/list.php?type=region&regcountry=1&authlogin=testsite&authpass=123123
```
(выдает список всех курортов по Египту (код 1))

---

## 6. subregion – список вложенных курортов (регионов)

**Тип информации:** `subregion`

Без параметров выдается полный список вложенных курортов.

**Параметры:**

| Параметр | Описание |
|----------|----------|
| `regcountry` | страна, по которой нужно получить список вложенных курортов |

**Поля в результате:**

| Поле | Описание |
|------|----------|
| `id` | идентификатор вложенного курорта |
| `name` | наименование вложенного курорта |
| `parentregion` | идентификатор "родительского" курорта. В одном курорте (region) может быть вложено несколько регионов (subregion). Детализация (вложенные курорты) присутствует только по ограниченному количеству курортов и стран. |

**Примеры:**

```
http://tourvisor.ru/xml/list.php?type=subregion&authlogin=testsite&authpass=123123
```
(выдает полный список курортов)

```
http://tourvisor.ru/xml/list.php?type=subregion&regcountry=1&authlogin=testsite&authpass=123123
```
(выдает список всех курортов по Египту (код 1))

---

## 7. meal – список типов питания

**Тип информации:** `meal`

Выдает полный список типов питания с кодами.

**Пример:**

```
http://tourvisor.ru/xml/list.php?type=meal&authlogin=testsite&authpass=123123
```

---

## 8. stars – список категорий отелей (звездность)

**Тип информации:** `stars`

Выдает полный список категорий отелей с кодами.

**Пример:**

```
http://tourvisor.ru/xml/list.php?type=stars&authlogin=testsite&authpass=123123
```

---

## 9. hotel – список отелей

**Тип информации:** `hotel`

Выдает список отелей. **Обязательно** нужно указать хотя бы код страны (`hotcountry`).

**Параметры:**

| Параметр | Описание |
|----------|----------|
| `hotcountry` | код страны, по которой нужно получить список отелей (**ОБЯЗАТЕЛЬНО!**) |
| `hotregion` | код курорта (можно несколько через запятую) |
| `hotstars` | звездность (и выше) |
| `hotrating` | рейтинг отеля (выше или равно которому будет отображаться) |
| `hotactive` | только отели "Активный" |
| `hotrelax` | только отели "Спокойный" |
| `hotfamily` | только отели "Семейный" |
| `hothealth` | только отели "Здоровье" |
| `hotcity` | только отели "Городской" |
| `hotbeach` | только отели "Пляжный" |
| `hotdeluxe` | только отели "Люкс (VIP)" |

**Примеры:**

```
http://tourvisor.ru/xml/list.php?type=hotel&hotcountry=1
```
(список отелей по Египту (1))

```
http://tourvisor.ru/xml/list.php?type=hotel&hotcountry=1&hotregion=5
```
(список отелей по курорту Хургада (5) страны Египет (1))

```
http://tourvisor.ru/xml/list.php?type=hotel&hotcountry=1&hotregion=5,15&hotstars=4&hotbeach=1
```
(список «пляжных» отелей по курортам Хургада и Эль Гуна (5) звездностью 4* и выше)

```
http://tourvisor.ru/xml/list.php?type=hotel&hotcountry=1&hotrating=4&hotstars=5&hotdeluxe=1
```
(список «VIP» отелей Египта 5* с рейтингом больше или равно 4)

---

## 10. operator – список туроператоров

**Тип информации:** `operator`

Выдает полный список активных туроператоров с кодами.

**Параметры (необязательно):**

| Параметр | Описание |
|----------|----------|
| `flydeparture` | код города вылета |
| `flycountry` | код страны |

Без параметров выдает полный список активных операторов. Если указан один или оба параметра - то выдает список активных операторов, у которых есть вылет из заданного города вылета в заданную страну.

**Пример:**

```
http://tourvisor.ru/xml/list.php?type=operator&authlogin=testsite&authpass=123123
```

---

## 11. flydate – список дат вылета

**Тип информации:** `flydate`

Выдает список доступных дат вылета для выбранного города вылета и страны (используется в календарике).

**Параметры (все обязательны):**

| Параметр | Описание |
|----------|----------|
| `flydeparture` | код города вылета (**обязательно!**) |
| `flycountry` | код страны (**обязательно!**) |

**Пример:**

```
http://tourvisor.ru/xml/list.php?type=flydate&flydeparture=3&flycountry=1&authlogin=testsite&authpass=123123
```
(выдает список доступных дат вылета в Египет из Екатеринбурга)

---

## 12. currency – курсы валют

**Тип информации:** `currency`

Выдает список активных операторов, для каждого передается курс валюты (в полях `usd` и `eur`).

**Пример:**

```
http://tourvisor.ru/xml/list.php?type=currency&authlogin=testsite&authpass=123123
```

---

## 13. services – список услуг в отелях

**Тип информации:** `services`

Выдает список услуг отелей, по которым возможна фильтрация в поиске туров.

Например, "первая береговая линия" - позволяет искать отели на первой линии.

**Пример:**

```
https://tourvisor.ru/xml/list.php?type=services&authlogin=YOURLOGIN&authpass=YOURPASS
```

---

## Получение нескольких типов данных за один запрос

Возможно за один запрос получать сразу несколько типов данных.

**Примеры:**

```
http://tourvisor.ru/xml/list.php?format=xml&type=departure,meal,stars
```
(получение за один запрос справочников по городам вылета, типам питания, категориям)

```
http://tourvisor.ru/xml/list.php?format=xml&type=departure,country,region&cndep=3&regcountry=4
```
(получение справочников - все города вылета, страны с вылетом из города Екатеринбург, курорты для страны Турция)

---

## 14. Получение информации JSONP

Возможно получение справочников прямо из Javascript.

В этом случае авторизация не требуется (т.к. иначе пришлось бы размещать пароль в открытом доступе), но запросы обязательно должны производиться с домена, который привязан к активной учетной записи в системе TourVisor.

Данный способ удобен для создания нестандартных форм, т.к. позволяет получать справочники прямо в скрипте и заполнять любые элементы формы нужными данными.

**Пример получения данных с использованием библиотеки jQuery:**

```
http://tourvisor.ru/xml/demojsonp.html
```

В этом примере происходит запрос городов вылета, затем полученной информацией заполняется SELECT (готовый элемент для формы), а также для примера заполняется DIV просто тестовой информацией по городам.
