# IAM Documentation — Авторизация

Документация по авторизации для работы с Yandex AI API с внешнего сервера.

## Структура папки (12 файлов)

```
iam/
├── quickstart-sa.md                    # Быстрый старт с сервисными аккаунтами
│
├── concepts/
│   ├── index.md                        # Обзор IAM
│   ├── authorization/
│   │   ├── index.md                    # Обзор способов авторизации
│   │   ├── api-key.md                  # API-ключи ⭐
│   │   ├── iam-token.md                # IAM-токены
│   │   └── oauth-token.md              # OAuth-токены
│   └── users/
│       └── service-accounts.md         # Сервисные аккаунты
│
├── operations/
│   ├── authentication/
│   │   └── manage-api-keys.md          # Создание/удаление API-ключей ⭐
│   └── sa/
│       ├── create.md                   # Создание сервисного аккаунта
│       └── assign-role-for-sa.md       # Назначение ролей
│
├── security/
│   └── index.md                        # Безопасность
│
└── best-practices/
    └── using-iam-securely.md           # Лучшие практики
```

---

## Детальное описание файлов

### `concepts/authorization/api-key.md` — API-ключи ⭐

**Когда использовать:** Основной способ авторизации для AI API с внешнего сервера.

**Содержание:**
- Что такое API-ключ
- API-ключи с ограничениями области действия (scopes)
- Срок действия ключей
- Безопасное хранение

**Области действия (scopes) для AI:**
| Scope | Описание |
|-------|----------|
| `yc.ai.foundationModels.execute` | Все AI API (рекомендуется) |
| `yc.ai.languageModels.execute` | Только генерация текста |
| `yc.ai.imageGeneration.execute` | Генерация изображений |

**Использование в коде:**
```python
from yandex_ai_studio_sdk import AIStudio

sdk = AIStudio(
    folder_id="<folder_id>",
    auth="<api_key>"  # Секретный API-ключ
)
```

**Важно:**
- API-ключ — секретный, хранить безопасно
- При компрометации — удалить и создать новый
- Можно ограничить срок действия

---

### `concepts/authorization/iam-token.md` — IAM-токены

**Когда использовать:** Альтернатива API-ключам, когда нужен токен с ограниченным временем жизни.

**Содержание:**
- Что такое IAM-токен
- Время жизни — не более 12 часов
- Способы получения

**Когда использовать IAM-токен вместо API-ключа:**
- Краткосрочные операции
- Дополнительная безопасность
- Интеграция с Yandex Cloud CLI

**Важно:**
- Время жизни — max 12 часов
- Нужно периодически обновлять
- API-ключ проще для внешнего хостинга

---

### `concepts/authorization/oauth-token.md` — OAuth-токены

**Когда использовать:** Для получения IAM-токена от имени пользователя.

**Содержание:**
- Что такое OAuth-токен
- Как получить через Yandex OAuth
- Обмен на IAM-токен

**Применение:**
- Авторизация от имени пользователя (не сервисного аккаунта)
- Интеграция с Yandex ID

---

### `concepts/users/service-accounts.md` — Сервисные аккаунты

**Когда использовать:** Для понимания, что такое сервисный аккаунт.

**Содержание:**
- Что такое сервисный аккаунт
- Отличие от пользовательского аккаунта
- Назначение ролей
- Использование в программах

**Ключевые моменты:**
- Сервисный аккаунт = аккаунт для программ
- Нужен для создания API-ключей
- Назначаются роли для доступа к сервисам

---

### `operations/authentication/manage-api-keys.md` — Управление API-ключами ⭐

**Когда использовать:** Пошаговая инструкция создания API-ключа.

**Содержание:**
- Создание API-ключа через консоль
- Создание через CLI
- Создание через API
- Удаление ключа
- Просмотр списка ключей

**Шаги создания:**
1. Перейти в консоль → IAM → Сервисные аккаунты
2. Выбрать сервисный аккаунт
3. Нажать "Создать API-ключ"
4. Сохранить секретный ключ (показывается только один раз!)

---

### `operations/sa/create.md` — Создание сервисного аккаунта

**Когда использовать:** Первый шаг настройки авторизации.

**Содержание:**
- Создание через консоль
- Создание через CLI
- Создание через API

---

### `operations/sa/assign-role-for-sa.md` — Назначение ролей

**Когда использовать:** После создания сервисного аккаунта.

**Содержание:**
- Назначение ролей на каталог
- Назначение ролей на ресурс
- Удаление ролей

**Роли для AI API:**
| Роль | Описание |
|------|----------|
| `ai.languageModels.user` | Использование моделей генерации текста |
| `ai.assistants.editor` | Создание и управление ассистентами |
| `ai.editor` | Полный доступ к AI Studio |

---

### `quickstart-sa.md` — Быстрый старт с сервисными аккаунтами

**Когда использовать:** Комплексное руководство для новичков.

**Содержание:**
- Проверка наличия ролей
- Создание сервисного аккаунта
- Назначение ролей
- Выполнение операций из CLI
- Удаление сервисного аккаунта

---

### `security/index.md` — Безопасность

**Когда использовать:** Для понимания системы ролей и прав доступа.

---

### `best-practices/using-iam-securely.md` — Лучшие практики

**Когда использовать:** Для безопасной настройки авторизации.

**Рекомендации:**
- Использовать минимальные необходимые права
- Ротировать ключи регулярно
- Не хранить ключи в коде
- Использовать переменные окружения

---

## Типичный флоу авторизации для AI-агента

### Шаг 1: Создать сервисный аккаунт
```bash
# Через консоль или CLI
yc iam service-account create --name ai-agent-sa
```
См. `operations/sa/create.md`

### Шаг 2: Назначить роль
```bash
# Минимальная роль для генерации текста
yc resource-manager folder add-access-binding <folder-id> \
    --role ai.languageModels.user \
    --subject serviceAccount:<sa-id>
```
См. `operations/sa/assign-role-for-sa.md`

### Шаг 3: Создать API-ключ
```bash
yc iam api-key create --service-account-name ai-agent-sa
```
См. `operations/authentication/manage-api-keys.md`

### Шаг 4: Использовать в коде
```python
import os
from yandex_ai_studio_sdk import AIStudio

sdk = AIStudio(
    folder_id=os.environ["YC_FOLDER_ID"],
    auth=os.environ["YC_API_KEY"]
)

model = sdk.models.completions("yandexgpt")
result = model.run("Привет!")
print(result[0].text)
```

---

## Выбор метода авторизации

| Метод | Для чего | Время жизни |
|-------|----------|-------------|
| **API-ключ** | Внешний хостинг, программы | Бессрочный (или заданный) |
| **IAM-токен** | Краткосрочные операции | Max 12 часов |
| **OAuth-токен** | От имени пользователя | Зависит от настроек |

**Для AI-агента на внешнем сервере рекомендуется: API-ключ**
