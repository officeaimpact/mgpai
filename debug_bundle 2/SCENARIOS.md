# SCENARIOS ‚Äî –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

## üéØ –¶–µ–ª—å

–ù–∞–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –ú–ì–ü.
–ö–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º.

---

## üìã –ë–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### SC-001: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–∞–∫–µ—Ç–Ω–æ–≥–æ —Ç—É—Ä–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –•–æ—á—É –≤ –ï–≥–∏–ø–µ—Ç –Ω–∞ 7 –Ω–æ—á–µ–π
User: –ò–∑ –ú–æ—Å–∫–≤—ã
User: 2 –≤–∑—Ä–æ—Å–ª—ã—Ö
User: –ù–∞ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–¥–µ–ª–µ
User: 5 –∑–≤—ë–∑–¥, –≤—Å—ë –≤–∫–ª—é—á–µ–Ω–æ
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã –≤ –ø–æ—Ä—è–¥–∫–µ –∫–∞—Å–∫–∞–¥–∞ (—Å—Ç—Ä–∞–Ω–∞ ‚Üí –≤—ã–ª–µ—Ç ‚Üí —Å–æ—Å—Ç–∞–≤ ‚Üí –¥–∞—Ç—ã ‚Üí –¥–µ—Ç–∞–ª–∏)
- –í—ã–¥–∞—ë—Ç 3-5 –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç—É—Ä–æ–≤
- –í—Å–µ —Ç—É—Ä—ã 5* —Å AI –ø–∏—Ç–∞–Ω–∏–µ–º

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] cascade_stage –ø—Ä–æ—Ö–æ–¥–∏—Ç 1 ‚Üí 2 ‚Üí 3 ‚Üí 4 ‚Üí 5 ‚Üí search
- [ ] search_params —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–æ–ª—è
- [ ] result_count > 0

---

### SC-002: –ü–æ–∏—Å–∫ –≥–æ—Ä—è—â–µ–≥–æ —Ç—É—Ä–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –ì–æ—Ä—è—â–∏–µ —Ç—É—Ä—ã –≤ –¢—É—Ä—Ü–∏—é
User: –ò–∑ –ü–∏—Ç–µ—Ä–∞
User: –û–¥–∏–Ω –≤–∑—Ä–æ—Å–ª—ã–π
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- search_mode = "burning"
- –í—ã–∑–æ–≤ hottours.php (–Ω–µ search.php)
- –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (< 5 —Å–µ–∫)

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] API endpoint = hottours.php
- [ ] elapsed_ms < 5000

---

### SC-003: –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ—Ç–µ–ª—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –û—Ç–µ–ª—å Rixos Premium –≤ –®–∞—Ä–º–µ
User: –ú–æ—Å–∫–≤–∞
User: 2 –≤–∑—Ä–æ—Å–ª—ã—Ö, 1 —Ä–µ–±—ë–Ω–æ–∫ 5 –ª–µ—Ç
User: –° 1 –ø–æ 8 —Ñ–µ–≤—Ä–∞–ª—è
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- hotel_name –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è
- –ü–æ–∏—Å–∫ –ø–æ hotel_id (–Ω–µ –ø–æ —Å—Ç—Ä–∞–Ω–µ)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è Rixos Premium

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] search_params.hotel_name = "Rixos Premium"
- [ ] –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Äî –æ–¥–∏–Ω –æ—Ç–µ–ª—å

---

### SC-004: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω—É (Hotel Filtering Bug)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –û—Ç–µ–ª—å –ñ–µ–º—á—É–∂–∏–Ω–∞ –≤ –°–æ—á–∏
User: –ò–∑ –ú–æ—Å–∫–≤—ã
User: 2 –≤–∑—Ä–æ—Å–ª—ã—Ö
User: –ù–∞ –Ω–µ–¥–µ–ª—é –≤ —è–Ω–≤–∞—Ä–µ
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω—É "–°–æ—á–∏" —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—Ç–µ–ª–∏ "–ñ–µ–º—á—É–∂–∏–Ω–∞" –≤ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä–æ–¥–∞—Ö (–ú–∞—Ö–∞—á–∫–∞–ª–∞ –∏ —Ç.–¥.)

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] API trace –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ä–µ–≥–∏–æ–Ω—É
- [ ] –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–µ–≥–∏–æ–Ω–µ –°–æ—á–∏

---

### SC-005: Smart Retry –Ω–∞ —Ç–æ—á–Ω—É—é –¥–∞—Ç—É

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –ï–≥–∏–ø–µ—Ç –∏–∑ –ú–æ—Å–∫–≤—ã, 2 –≤–∑—Ä–æ—Å–ª—ã—Ö
User: –°—Ç—Ä–æ–≥–æ 15 —è–Ω–≤–∞—Ä—è –Ω–∞ 7 –Ω–æ—á–µ–π
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–µ—Ä–≤—ã–π –ø–æ–∏—Å–∫ —Å flex_days=0
- –ï—Å–ª–∏ 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å flex_days=2
- date_warning=true –≤ –æ—Ç–≤–µ—Ç–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –î–≤–∞ API –≤—ã–∑–æ–≤–∞ search.php (–µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –ø—É—Å—Ç–æ–π)
- [ ] date_warning —Ñ–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

---

### SC-006: –≠—Å–∫–∞–ª–∞—Ü–∏—è –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (–≥—Ä—É–ø–ø–∞ > 6)

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –¢—É—Ä—Ü–∏—è –∏–∑ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞
User: 8 –≤–∑—Ä–æ—Å–ª—ã—Ö
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
- –ù–ï –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–∫–∞—Ç—å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API: max 6 adults)

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç "–º–µ–Ω–µ–¥–∂–µ—Ä" –∏–ª–∏ "–ø–æ–∑–≤–æ–Ω–∏—Ç–µ"
- [ ] API –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

---

### SC-007: FAQ ‚Äî –Ω–µ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
User: –ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è –≤–∏–∑—ã –≤ –¢—É—Ä—Ü–∏—é?
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (FAQ)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å—Ü–µ–Ω–∞—Ä–∏—é –ø–æ–¥–±–æ—Ä–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] detected_intent = "faq" –∏–ª–∏ "visa_info"
- [ ] –û—Ç–≤–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π (–Ω–µ "–Ω–µ –ø–æ–Ω—è–ª")

---

## üîÑ –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### REG-001: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–æ–ª—å–∫–æ –≤ –Ω–∞—á–∞–ª–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ë–æ—Ç –≥–æ–≤–æ—Ä–∏—Ç "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ" —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, –Ω–µ –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö.

### REG-002: –ì–æ—Ä–æ–¥ –≤—ã–ª–µ—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –î–∞–∂–µ –ø—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –æ—Ç–µ–ª—è –±–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–ò–∑ –∫–∞–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –≤—ã–ª–µ—Ç?"

### REG-003: –°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ —Å —Ç–µ–º –∂–µ session_id –±–æ—Ç –ø–æ–º–Ω–∏—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------------|
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ | < 3 —Å–µ–∫ (–±–µ–∑ API) |
| –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ —Ç—É—Ä–æ–≤ | < 30 —Å–µ–∫ |
| –¢–æ—á–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤ | > 95% |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ | > 80% |

---

## üîß –ó–∞–ø—É—Å–∫ —Å—Ü–µ–Ω–∞—Ä–∏—è

```bash
# –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
export DEBUG_LOGS=1

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
uvicorn app.main:app --reload

# –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π —á–µ—Ä–µ–∑ API –∏–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
python debug_bundle/export_traces.py
```
